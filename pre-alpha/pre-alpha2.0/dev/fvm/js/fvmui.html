<!--
 * Copyright Â© 2017, Robert Gollagher.
 * SPDX-License-Identifier: GPL-3.0+
 * 
 * File:       fvmui.html
 * Author :    Robert Gollagher   robert.gollagher@freeputer.net
 * Created:    20170303
 * Updated:    20170617-0951+
 * Version:    pre-alpha-0.0.0.37+ for FVM 2.0
-->
<!DOCTYPE html>
<html>
<head>
<title>FVM</title>
<meta charset="UTF-8">
<script src="fvm2.js"></script>
<script src="fvma.js"></script>
<script src="prg.js"></script>
<script src="prgBase64.js"></script>
<script>
window.onload = function() { 'use strict';
  // Source for assembler is declared as prgSrc within prg.js
  fvmSrc.textContent = prgSrc;
  // Default program is loaded from prgBase64 binary and is unrelated to prgSrc
  var prg = Uint8Array.from(atob(prgBase64), c => c.charCodeAt(0)).buffer;
  modFVMUI = modFVMUI_init(prg);
};

// Module modFVMUI connects this UI to an FVM provided by modFVM
//   and to a Freeputer Assembler provided by modFVMA
var modFVMUI;
function modFVMUI_init(prg) { 'use strict';

  var elem = x => document.getElementById(x);
  var fvmSrc = elem('fvmSrc');
  var fvmAs = elem('fvmAs');
  var fvmStdout = elem('fvmStdout');
  var fvmUsrout = elem('fvmUsrout');
  var fvmGrdout = elem('fvmGrdout');
  var fvmStdlog = elem('fvmStdlog');
  var fvmStdtrc = elem('fvmStdtrc');

  function asm() {
    clr(fvmAs);
    var fnMsg = x => fvmAs.textContent+=x+'\n';
    prg = modFVMA.makeFVMA(fnMsg).asm(fvmSrc.value);
  }

  function clr(x) {
    x.textContent = '';
  }

  function clear() {
    clr(fvmAs);
    clr(fvmStdout);
    clr(fvmUsrout);
    clr(fvmGrdout);
    clr(fvmStdlog);
    clr(fvmStdtrc);
  };

  function run() {
    var cf = modFVM.makeConfig(prg);
    var chr = x => String.fromCharCode(x);
    cf.fnStdout = x => fvmStdout.textContent+=chr(x);
    cf.fnUsrout = x => fvmUsrout.textContent+=chr(x);
    cf.fnGrdout = x => fvmGrdout.textContent+=chr(x);
    cf.fnLog = x => fvmStdlog.textContent+=chr(x);
    cf.fnTrc = x => fvmStdtrc.textContent+=x+'\n';
    cf.RAMa = 0x1000000;
    cf.RAMz = 0x1000400;
    modFVM.makeFVM(cf).run();
  };

  return {
    asm: asm,
    clear: clear,
    run : run
  };
}; // modFVMUI
</script>
<link rel="stylesheet" type="text/css" href="fvm.css">
</head>

<body>
  <div class="fvmDiv">
    <h2>Freeputer Virtual Machine</h2>
    <table class="fvmMaxed">
       <tr>
        <td>   
          <input type="button" id="assemble" value="Assemble" title="Assemble program from Source" onclick="modFVMUI.asm()"/>  
          <input type="button" id="restartFVM" value="Restart" title="Start or restart the FVM instance" onclick="modFVMUI.run()"/>
          <input type="button" id="clear" value="Clear" title="Clear previous output" onclick="modFVMUI.clear()"/>
          <span class="fvmWarning">Incomplete</span> pre-alpha-0.0.0.37+ for FVM 2.0.
        </td>
      </tr>
       <tr>
        <td>
        </td>
      </tr>
      <tr>
        <td>
          <table class="fvmMaxed">
            <tr>
              <td>
                <b>Assembler</b>
              </td>
            </tr>
            <tr>
              <td class="fvmOut fvmSmall fvmScroll">
                  <pre><code><span id="fvmAs"></span></code></pre>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table class="fvmMaxed">
            <tr>
              <td>
                <b>stdtrc</b>
              </td>
            </tr>
            <tr>
              <td class="fvmOut fvmMaxed">
                  <pre><code><span id="fvmStdtrc"></span></code></pre>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table class="fvmMaxed">
            <tr>
              <td>
                <b>Source</b> ( 0x = hex, 0f = forward, 0r = reverse, 0n = within phrase, 0p = phrase num, / = token is a comment )
              </td>
            </tr>
            <tr>
              <td>
                  <textarea id="fvmSrc" class="fvmOut" rows="40" cols="80" wrap="off"></textarea>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table class="fvmMaxed">
            <tr>
              <td>
                <b>stdlog</b>
              </td>
            </tr>
            <tr>
              <td class="fvmOut fvmSmall fvmScroll">
                  <pre><code><span id="fvmStdlog"></span></code></pre>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table class="fvmMaxed">
            <tr>
              <td>
                <b>stdout</b>
              </td>
            </tr>
            <tr>
              <td class="fvmOut fvmSmall fvmScroll">
                  <pre><code><span id="fvmStdout"></span></code></pre>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table class="fvmMaxed">
            <tr>
              <td>
                <b>grdout</b>
              </td>
            </tr>
            <tr>
              <td class="fvmOut fvmSmall fvmScroll">
                  <pre><code><span id="fvmGrdout"></span></code></pre>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <table class="fvmMaxed">
            <tr>
              <td>
                <b>usrout</b>
              </td>
            </tr>
            <tr>
              <td class="fvmOut fvmSmall fvmScroll">
                  <pre><code><span id="fvmUsrout"></span></code></pre>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
  </div>
</body>
</html>
